<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - RecipeHub</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* tiny inline style for the disabled state */
    button[disabled] { opacity: 0.6; pointer-events: none; }
  </style>
</head>
<body class="auth-body">
  <!-- Background Floating Emojis -->
  <div class="auth-bg">
    <span class="bg-emoji" style="--x: 10%; --y: 20%; --delay: 0s">üçî</span>
    <span class="bg-emoji" style="--x: 80%; --y: 30%; --delay: 1s">üçú</span>
    <span class="bg-emoji" style="--x: 20%; --y: 70%; --delay: 2s">ü•ò</span>
    <span class="bg-emoji" style="--x: 90%; --y: 80%; --delay: 3s">üç∞</span>
  </div>

  <!-- Login Form Container -->
  <div class="auth-container">
    <div class="auth-card">
      <!-- Header Logo & Welcome Text -->
      <div class="auth-header">
        <div class="logo">
          <span class="logo-icon">üç≥</span>
          <span class="logo-text">RecipeHub</span>
        </div>
        <h1 class="auth-title">Welcome Back!</h1>
        <p class="auth-subtitle">Sign in to your account and continue cooking</p>
      </div>

      <!-- Login Form -->
      <form class="auth-form" id="loginForm">
        <div class="form-group">
          <label for="email" class="form-label">Email Address</label>
          <div class="input-container">
            <span class="input-icon">üìß</span>
            <input
              type="email"
              id="email"
              name="email"
              class="form-input"
              placeholder="your@email.com"
              required
            />
          </div>
        </div>

        <div class="form-group">
          <label for="password" class="form-label">Password</label>
          <div class="input-container">
            <span class="input-icon">üîí</span>
            <input
              type="password"
              id="password"
              name="password"
              class="form-input"
              placeholder="Enter your password"
              required
            />
          </div>
        </div>

        <button id="loginBtn" type="submit" class="btn btn-primary btn-large btn-full">
          Sign In ‚ú®
        </button>
      </form>

      <!-- Auth Footer -->
      <div class="auth-footer">
        <p class="auth-link-text">
          Don't have an account? 
          <a href="signup.html" class="auth-link">Create one here</a>
        </p>
        <div class="auth-divider"><span>or</span></div>
        <a href="index.html" class="btn btn-outline btn-full">Back to Home üè†</a>
      </div>
    </div>
  </div>

  <script>
    // Same logic as signup: local when testing locally, otherwise use deployed Render backend
    const DEFAULT_RENDER_BACKEND = 'https://recipehub-9vlb.onrender.com'; // <-- change if your Render URL is different
    const API_BASE_URL = (function () {
      if (window.API_BASE_URL) return window.API_BASE_URL;
      const host = location.hostname;
      if (host === 'localhost' || host === '127.0.0.1') return 'http://localhost:3000';
      return DEFAULT_RENDER_BACKEND;
    })();

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const loginBtn = document.getElementById('loginBtn');
      loginBtn.disabled = true;

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      try {
        const res = await fetch(`${API_BASE_URL}/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });

        let result = {};
        try { result = await res.json(); } catch (err) { /* ignore parse error */ }

        if (res.ok) {
          // Optional: save user info in localStorage if you use it elsewhere
          try {
            if (result.user) localStorage.setItem('recipehub_user', JSON.stringify(result.user));
          } catch (e) { /* ignore storage errors */ }

          alert("‚úÖ Login successful! Welcome " + (result.user?.fullName || ''));
          window.location.href = "dashboard.html";
        } else {
          const msg = result && (result.error || result.message) ? (result.error || result.message) : `Login failed (status ${res.status})`;
          alert(msg);
        }
      } catch (err) {
        console.error("Login error:", err);
        if (err.message && (err.message.includes('Failed to fetch') || err.message.includes('NetworkError'))) {
          alert("Network error: couldn't reach the backend. If you're testing locally, make sure your Node server is running on http://localhost:3000. If using Render, make sure DB is connected and the Render URL is correct.");
        } else {
          alert("‚ùå An error occurred during login.");
        }
      } finally {
        loginBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
