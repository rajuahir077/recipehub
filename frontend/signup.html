<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign Up - RecipeHub</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* tiny inline style for the disabled state so you don't have to change CSS right now */
    button[disabled] { opacity: 0.6; pointer-events: none; }
  </style>
</head>
<body class="auth-body">

  <!-- Background Emojis -->
  <div class="auth-bg">
    <span class="bg-emoji" style="--x: 15%; --y: 15%; --delay: 0s">ğŸ¥‘</span>
    <span class="bg-emoji" style="--x: 85%; --y: 25%; --delay: 1s">ğŸ•</span>
    <span class="bg-emoji" style="--x: 10%; --y: 80%; --delay: 2s">ğŸ§</span>
    <span class="bg-emoji" style="--x: 80%; --y: 70%; --delay: 3s">ğŸ¥—</span>
  </div>

  <!-- Signup Form Container -->
  <div class="auth-container">
    <div class="auth-card">

      <!-- Header -->
      <div class="auth-header">
        <div class="logo">
          <span class="logo-icon">ğŸ³</span>
          <span class="logo-text">RecipeHub</span>
        </div>
        <h1 class="auth-title">Join RecipeHub!</h1>
        <p class="auth-subtitle">Create your account and start sharing recipes</p>
      </div>

      <!-- Signup Form -->
      <form class="auth-form" id="signupForm">
        <div class="form-group">
          <label for="fullName" class="form-label">Full Name</label>
          <div class="input-container">
            <span class="input-icon">ğŸ‘¤</span>
            <input type="text" id="fullName" name="fullName" class="form-input" placeholder="Your full name" required />
          </div>
        </div>

        <div class="form-group">
          <label for="email" class="form-label">Email Address</label>
          <div class="input-container">
            <span class="input-icon">ğŸ“§</span>
            <input type="email" id="email" name="email" class="form-input" placeholder="your@email.com" required />
          </div>
        </div>

        <div class="form-group">
          <label for="password" class="form-label">Password</label>
          <div class="input-container">
            <span class="input-icon">ğŸ”’</span>
            <input type="password" id="password" name="password" class="form-input" placeholder="Create a password" required />
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword" class="form-label">Confirm Password</label>
          <div class="input-container">
            <span class="input-icon">ğŸ”’</span>
            <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" placeholder="Confirm your password" required />
          </div>
        </div>

        <button id="submitBtn" type="submit" class="btn btn-success btn-large btn-full">Create Account ğŸ‰</button>
      </form>

      <!-- Footer -->
      <div class="auth-footer">
        <p class="auth-link-text">
          Already have an account? 
          <a href="login.html" class="auth-link">Sign in here</a>
        </p>
        <div class="auth-divider"><span>or</span></div>
        <a href="index.html" class="btn btn-outline btn-full">Back to Home ğŸ </a>
      </div>

    </div>
  </div>

  <script>
    /**
     * API base selection logic:
     * - If you're testing locally (localhost or 127.0.0.1) -> use local backend https://recipehub-9vlb.onrender.com
     * - Otherwise use your deployed backend on Render. Replace the URL below with your real Render URL if it's different.
     *
     * If you later deploy frontend and backend to the same domain, change this logic accordingly.
     */
    const DEFAULT_RENDER_BACKEND = 'https://recipehub-9vlb.onrender.com'; // <-- replace if your Render URL is different

    const API_BASE_URL = (function () {
      // allow overriding via a global variable if you want:
      if (window.API_BASE_URL) return window.API_BASE_URL;

      const host = location.hostname;
      if (host === 'localhost' || host === '127.0.0.1') {
        return 'https://recipehub-9vlb.onrender.com';
      }
      // running on the web (not local) -> use the Render backend
      return DEFAULT_RENDER_BACKEND;
    })();

    document.getElementById("signupForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;

      const fullName = document.getElementById("fullName").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      if (password !== confirmPassword) {
        alert("Passwords do not match!");
        submitBtn.disabled = false;
        return;
      }

      const user = { fullName, email, password };

      try {
        const response = await fetch(`${API_BASE_URL}/signup`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(user),
        });

        // try to parse JSON safely
        let data = {};
        try { data = await response.json(); } catch (err) { /* ignore parse error */ }

        if (response.ok) {
          alert("âœ… Account created successfully!");
          // redirect to login page
          window.location.href = "login.html";
        } else {
          // Backend returned an error (like 400/500). Show a useful message if available.
          const msg = data && (data.error || data.message) ? (data.error || data.message) : `Signup failed (status ${response.status})`;
          alert(msg);
        }
      } catch (err) {
        console.error("Signup error:", err);
        // Helpful message for connection errors
        if (err.message && (err.message.includes('Failed to fetch') || err.message.includes('NetworkError'))) {
          alert("Network error: couldn't reach the backend. If you're testing locally, make sure your Node server is running on https://recipehub-9vlb.onrender.com. If using Render, make sure DB is connected and the Render URL is correct.");
        } else {
          alert("An error occurred while signing up.");
        }
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>

